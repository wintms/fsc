# 多项式校准配置示例

## 概述

这个文档展示了如何在FSC（风扇速度控制）系统中使用多项式校准配置。多项式校准允许使用数学公式来精确描述温度校准和PWM控制曲线。

## 配置文件: fsc_polynomial_example.json

### 1. 环境校准 (Ambient Calibration) - 多项式类型

```json
"ambient_calibration": {
    "cal_type": 0,              // 0 = 多项式校准 (FSC_AMBIENT_CAL_POLYNOMIAL)
    "coeff_count": 4,           // 系数个数
    "coefficients": [8.0, -0.05, 0.0001, -0.000001]  // 多项式系数 [a0, a1, a2, a3]
}
```

**多项式公式:**
```
ΔT = a0 + a1×PWM + a2×PWM² + a3×PWM³
ΔT = 8.0 - 0.05×PWM + 0.0001×PWM² - 0.000001×PWM³
```

**说明:**
- `ΔT`: 入口传感器与环境温度的差值
- `PWM`: 当前风扇PWM值 (0-100)
- 系数含义:
  - `a0 = 8.0`: 常数项，PWM=0时的温度差
  - `a1 = -0.05`: 一次项系数，主要线性校正
  - `a2 = 0.0001`: 二次项系数，非线性校正
  - `a3 = -0.000001`: 三次项系数，高阶非线性校正

### 2. 环境基准曲线 (Ambient Base Curve) - 多项式类型

```json
{
    "label": "Ambient base curve control",
    "profile_index": 3,
    "sensor_num": 116,
    "sensor_name": "SW_U16",
    "type": "ambient_base",
    "curve_type": 0,            // 0 = 多项式曲线
    "load_scenario": 0,         // 0 = 空闲, 1 = 低功耗, 2 = 满载
    "coeff_count": 3,           // 系数个数
    "coefficients": [25.0, 0.75, 0.005],  // 多项式系数 [b0, b1, b2]
    "falling_hyst": 2,          // 下降滞后 (°C)
    "max_rising_rate": 10,      // 最大上升速率 (%/周期)
    "max_falling_rate": 5       // 最大下降速率 (%/周期)
}
```

**多项式公式:**
```
PWM = b0 + b1×T_ambient + b2×T_ambient²
PWM = 25.0 + 0.75×T_ambient + 0.005×T_ambient²
```

**说明:**
- `T_ambient`: 环境温度 (°C)
- `PWM`: 计算得出的风扇PWM值
- 系数含义:
  - `b0 = 25.0`: 基础PWM值
  - `b1 = 0.75`: 线性响应系数
  - `b2 = 0.005`: 非线性响应系数

## 计算示例

### 环境校准计算示例

假设入口传感器读数为45°C，当前PWM为60%：

```
ΔT = 8.0 - 0.05×60 + 0.0001×60² - 0.000001×60³
ΔT = 8.0 - 3.0 + 0.36 - 0.216
ΔT = 5.144°C

环境温度 = 入口温度 - ΔT = 45 - 5.144 = 39.856°C
```

### 环境基准曲线计算示例

假设环境温度为40°C：

```
PWM = 25.0 + 0.75×40 + 0.005×40²
PWM = 25.0 + 30.0 + 8.0
PWM = 63%
```

## 与分段线性的对比

| 特性 | 多项式 | 分段线性 |
|------|--------|----------|
| 配置复杂度 | 简单（几个系数） | 复杂（多个点） |
| 曲线平滑度 | 非常平滑 | 在节点处可能有折点 |
| 计算复杂度 | 中等 | 低 |
| 灵活性 | 受多项式阶数限制 | 非常灵活 |
| 适用场景 | 平滑变化的物理关系 | 复杂的非线性关系 |

## 配置建议

1. **系数选择**: 根据实际测试数据拟合多项式系数
2. **阶数选择**: 通常3-4阶足够，过高阶数可能导致数值不稳定
3. **范围验证**: 确保在工作范围内多项式值合理
4. **测试验证**: 在实际环境中验证计算结果的准确性

## 注意事项

1. 多项式在边界值处可能出现异常行为
2. 高阶多项式可能在某些区间产生振荡
3. 建议在配置前进行数值仿真验证
4. 系数精度要适当，避免浮点运算误差累积